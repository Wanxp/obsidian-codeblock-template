/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var x=(l,a)=>{for(var e in a)C(l,e,{get:a[e],enumerable:!0})},T=(l,a,e,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let t of B(a))!A.call(l,t)&&t!==e&&C(l,t,{get:()=>a[t],enumerable:!(i=b(a,t))||i.enumerable});return l};var I=l=>T(C({},"__esModule",{value:!0}),l);var F={};x(F,{default:()=>N});module.exports=I(F);var h=require("obsidian");var p=require("obsidian"),m=class{constructor(a,e){this.app=a,this.codeName2Path=e}updateCodeName2Path(a){this.codeName2Path=a}async getSourceContentOfCBName(a,e,i){let t=this.codeName2Path[a];if(t==null){new p.Notice("Pack-View name invalid\uFF01");return}let n=this.app.vault.getAbstractFileByPath(t),s=await this.app.vault.read(n),c=s.match(o.getReCodeBlockPrefix(a))?.[0];if(c==null)return;let u=s.match(o.getReCompletionCodeBlock(c))?.[0];if(u==null){new p.Notice("Pack-Source prefix formation invalid\uFF01");return}let d=u.match(o.getReCodeBlockContent(c))?.[0];if(d==null){new p.Notice("Pack-Source content formation invalid\uFF01");return}let r=d?.match(o.reNeedReplaceStr);if(r==null)return console.log("There are no variables to replace\uFF01"),d;let S=d;for(let v of r){let k=v.match(o.reVariableName)?.[0];if(k==null){new p.Notice("Source Variable name invalid\uFF01");continue}e.includes(k)?S=d.replaceAll(v,i[k]):(new p.Notice("Replace invalid\uFF01More info in console."),console.log("Replace invalid\uFF1AThe input variable and the variable to be replaced have different names."))}return S}},g=class{constructor(a){this.app=a}async listAllFile(a,e){let i=await this.app.vault.adapter.list(a);for(let t of i.folders)t.indexOf("./.obsidian/")!=-1||t.indexOf("./.trash/")!=-1||this.listAllFile(t,e);for(let t of i.files)t.indexOf(".md")!=-1&&e.push(t)}async findMarkdomName(a,e){let i=await this.app.vault.adapter.list(".");for(let t of i.folders)t.indexOf("./.obsidian/")!=-1||t.indexOf("./.trash/")!=-1||t.indexOf(a)!=-1||this.findMarkdomName(t,e);for(let t of i.files)t.indexOf(".md")!=-1&&e.push(t)}},P=class{static removeConvertChar(a){return a.replaceAll('\\"','"').replaceAll("\\'","'").replaceAll("\\n",`
`).replaceAll("\\t","	").replaceAll("\\r","\r").replaceAll("\\b","\b").replaceAll("\\f","\f").replaceAll("\\v","\v").replaceAll("\\0","\0").replaceAll("\\\\","\\")}},o=class{static getReCompletionCodeBlock(a){let e=0;for(;a[++e]=="`";);return new RegExp(a+"[\\s\\S]*?`{"+e+"}","g")}static getReCodeBlockContent(a){let e=0;for(;a[++e]=="`";);return new RegExp("(?<=[`]{"+e+"}pack-source[\\s]*[_a-zA-Z][\\w]*\\n)[\\s\\S]*?(?=\\n`{"+e+"})","g")}static getReCodeBlockPrefix(a){return new RegExp("[`]{3,9}pack-source[\\s]*"+a+"\\n","g")}};o.reCodeBlockPrefix4Source=/[`]{3,9}pack-source[\s]*[a-zA-Z_][\w]*\n/g,o.reCodeBlockPrefix4View=/[`]{3,9}pack-source[\s]*[a-zA-Z_][\w]*\n/g,o.reCodeBlockName4Source=/(?<=`{3,9}pack-source[\s]*)[a-zA-Z_][\w]*/g,o.reCodeBlockName4View=/(?<=`{3,9}pack-view[\s]*)[a-zA-Z_][\w]*/g,o.reNeedReplaceStr=/\$\.\{[\s\S]*?\}/g,o.reVariableName=/(?<=\$\.\{\s*)[_a-zA-Z]\w*(?=\s*\})/g,o.variableSynatx=/^[_a-zA-Z]\w*$/,o.conChar=/(\\\\)+[a-zA-Z]?/g;var f=require("obsidian"),y={sourcePath:"templates",viewCodeBlockInfos:{}},w=class extends f.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}async display(){let{containerEl:e}=this;e.empty(),new f.Setting(e).setName("Template Source Path").setDesc("Default Path /templates").addText(i=>{i.setPlaceholder("Input Source Path").setValue(this.plugin.settings.sourcePath?this.plugin.settings.sourcePath:"").onChange(async t=>{if(t==""){new f.Notice("CodeBlockTemplate-Plugin\uFF1ASource Path is undefined\uFF01This will cause the plugin not to work.");return}this.plugin.settings.sourcePath=t,await this.plugin.saveSettings(),await this.plugin.getSourceName2FilePath(),this.plugin.renderAll()})})}};var N=class extends h.Plugin{constructor(){super(...arguments);this.isEvent=!1;this.sourceNameList=[];this.oldSourceNameList=[];this.sourceName2FilePath={};this.oldSourceName2FilePath={};this.cbInfos={}}async onload(){await this.loadSettings(),this.addSettingTab(new w(this.app,this)),await this.initialize(),this.settings.sourcePath===""&&new h.Notice("CodeBlockTemplate Plugin\uFF1ASource Path is undefined\uFF01")}onunload(){}async loadSettings(){this.settings=Object.assign({},y,await this.loadData())}async saveSettings(){this.settings.viewCodeBlockInfos=this.cbInfos,await this.saveData(this.settings)}async initialize(){await this.getSourceName2FilePath(),this.registerMarkdownCodeBlockProcessor("pack-view",(e,i,t)=>{let n=this.getCodeBlockName(t,i);n!=null&&(i.className="pack-view-"+n,this.cbInfos[n]={source:e,elID:i.id,path:t.sourcePath},this.saveSettings(),this.render(n,e,t.sourcePath))}),this.registerMarkdownCodeBlockProcessor("pack-source",async(e,i,t)=>{i.createEl("pre").createEl("code",{text:e}),await this.getSourceName2FilePath();let n=this.getCodeBlockName(t,i);if(n==null)return;let s=this.cbInfos[n];this.settings.viewCodeBlockInfos[n]!=null&&this.render(n,s.source,s.path)})}async getSourceName2FilePath(){let e=new g(this.app);if(this.oldSourceNameList=this.sourceNameList,this.oldSourceName2FilePath=this.sourceName2FilePath,this.sourceName2FilePath={},this.sourceNameList=[],!await this.app.vault.adapter.exists(this.settings.sourcePath))return;let i=[];await e.listAllFile(this.settings.sourcePath,i);for(let t of i){let s=(await this.app.vault.adapter.read(t)).match(o.reCodeBlockName4Source);if(s==null)return;for(let c of s)this.sourceName2FilePath[c]=t,this.sourceNameList.push(c)}}async getTemplContent(e,i){let t=new m(this.app,this.sourceName2FilePath),n=[],s={},c=i.split(`
`).filter(u=>u.length>0);for(let u of c){let[d,r]=u.split("=");if(d=d.trim(),r=r.trim(),r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,r.length-1)),r=P.removeConvertChar(r),typeof d!=typeof r||!o.variableSynatx.test(d)){new h.Notice("Data formation invalid\uFF01Maybe the variable name is not in the right format. ");return}s[d]=r,n.push(d)}return await t.getSourceContentOfCBName(e,n,s)}render2TemplContent(e,i,t){let n=document.getElementsByClassName("pack-view-"+e);for(let s=0;s<n.length;s++){let c=n[s];if(c==null)return;c.empty(),i!=null?h.MarkdownRenderer.renderMarkdown(i,c,t,this):h.MarkdownRenderer.renderMarkdown("",c,t,this)}}async render(e,i,t){let n=await this.getTemplContent(e,i);this.render2TemplContent(e,n,t)}async renderAll(){if(this.sourceNameList.length!=0){for(let e of this.sourceNameList)if(this.cbInfos[e]!=null){let i=this.cbInfos[e];this.render(e,i.source,i.path)}}else if(this.oldSourceNameList.length!=0){for(let e of this.oldSourceNameList)if(this.cbInfos[e]!=null){let i=this.cbInfos[e];this.render2TemplContent(e,void 0,i.path)}}}getCodeBlockName(e,i){let t=e.getSectionInfo(i);return t?.text.split(`
`)[t.lineStart].match(o.reCodeBlockName4View)?.[0]}};
